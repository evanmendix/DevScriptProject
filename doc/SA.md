# 系統架構 (System Architecture)

本文件從高層次概述了此應用程式的架構設計、技術選型和核心設計原則。

---

### 1. 應用程式概述

本專案是一個單機桌面應用程式，旨在為 Windows 使用者提供一個現代化、圖形化的介面，用於管理和執行各類本地腳本（`.bat`, `.ps1`, `.py`）。其核心目標是提升效率，並為複雜的腳本執行提供便利（如背景任務和虛擬環境管理）。

---

### 2. 技術棧 (Technology Stack)

- **程式語言**: **Python 3**
- **GUI 框架**: **CustomTkinter**
    - 選擇理由：基於 Python 內建的 Tkinter，輕量且跨平台。CustomTkinter 在此基礎上提供了現代化的外觀和更豐富的元件，適合快速開發美觀的桌面應用。
- **環境與依賴管理**: **uv**
    - 選擇理由：一個極速的 Python 套件安裝與管理工具，透過 `pyproject.toml` 進行宣告式依賴管理，簡化了開發環境的設定。

---

### 3. 高層架構

本應用程式採用了經典的 **模型-視圖-控制器 (MVC)** 設計模式的變體。

- **模型 (Model)**:
    - 由 `scripts.json` 檔案和載入到記憶體中的 `self.scripts_config` 列表構成。
    - 它代表了應用的核心資料狀態，完全獨立於 UI。

- **視圖 (View)**:
    - 由 `ScriptLauncher` 和 `AddScriptWindow` 類別中所有的 `customtkinter` 元件構成。
    - 負責將模型中的資料以圖形化的方式呈現給使用者。
    - 視圖的更新是響應式的，由控制器在模型變更後觸發。

- **控制器 (Controller)**:
    - 控制器邏輯主要實作在 `ScriptLauncher` 的各類方法中（例如 `_on_rename_button_click`, `start_script_execution`, `save_config` 等）。
    *   負責接收來自視圖的使用者輸入（按鈕點擊、文字輸入等）。
    *   處理業務邏輯（例如，啟動一個執行緒來執行腳本）。
    *   在需要時更新模型（例如，新增或移除一個腳本設定）。
    *   在模型更新後，觸發視圖的重新繪製 (`populate_scripts_ui`)。

---

### 4. 核心架構特性

- **非同步執行引擎**:
    - 為了確保 UI 的流暢和響應性，所有腳本的執行都在獨立的背景執行緒中進行。
    - 透過 **執行緒安全佇列 (`queue.Queue`)** 機制，將背景執行緒的輸出安全地傳遞回主 UI 執行緒進行顯示。這是本應用避免界面凍結的核心架構。

- **設定驅動 (Configuration-Driven)**:
    - 整個應用的狀態都圍繞 `scripts.json` 這個設定檔。使用者所有的自訂內容（腳本路徑、名稱、類型）都被持久化儲存。
    - 這種設計使得使用者的設定可以輕鬆地備份、分享或進行版本控制。

- **關注點分離 (Separation of Concerns)**:
    - **UI 與邏輯分離**: UI 的定義（`__init__`中的元件建立）與其背後的業務邏輯（事件處理方法）是分開的。
    - **資料與顯示分離**: 在腳本類型的處理上，內部資料 (`one-time`) 與向使用者顯示的文字 (`一次性`) 是分開的，透過映射字典進行轉換。這為未來的多語言支援打下了基礎。
